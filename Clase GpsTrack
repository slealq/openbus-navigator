from datetime import datetime
'''
    Programa que toma archivos .txt con los tracks GPS y los descompone en
    objetos de la Clase GpsTracks.
    Ultimos cambios agregar clase GpsTrack con sus atributos
'''

def subString(strIni, strFin, string):
    '''
    Funcion que genera un subString despu√©s de un strIni hasta un strFin tomando
    como padre a string. Retorna el substring formado entre ambos parametros
    
    strIni := str inicial
    strFin := str final
    string := str de origen
    Return subStr := str de retorno y -1 en caso de que no exista coincidencia
    ''' 
    if strIni in string and strFin in string:
        indexIni = string.find(strIni)+len(strIni)
        indexFin = string.find(strFin)
        subStr = string[indexIni:indexFin]
    else:
        subStr = -1
    return subStr


class GpsTrack:
    '''
        Atributos:
        ID = Integer que contiene el identificador del track
        name = string que posee el nombre del archivo del track
        date = string que posee la fecha de creacion del track en formato
    AAAA/MM/DD/hh/mm
        waypoints = array de listas que contiene la informacion de todos los
    puntos gps tomados en el track en formato [lat,lon,ele,time]
    '''
    ID = 0
    name = ""
    date = ""
    waypoints = []
    
    #Constructor por defecto de la clase
    def __init__(self, path, ID):
        self.ID = ID
        file = open(path, "r")
        waypoints = []
        cont = 0
        for line in file:
            if line.startswith("<name>"):
                self.name = subString("<name>","</name>",line)
                self.date = subString("Track ","</name>",line)
            elif line.startswith("<trkpt"):
                lat = float(subString('lat="','" lon',line))
                lon = float(subString('lon="','">\n',line))
                ele = float(subString('<ele>','</ele>',file.readline()))
                time = subString('<time>','</time>',file.readline())
                waypoints.append([lat,lon,ele,time])
        file.close()
        self.waypoints = waypoints
